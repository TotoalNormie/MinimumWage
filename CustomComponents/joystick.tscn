[gd_scene load_steps=6 format=3 uid="uid://bodumasxiqoqw"]

[ext_resource type="Script" path="res://Scripts/joystick.gd" id="1_35q8m"]
[ext_resource type="StyleBox" uid="uid://bnhx16uqx3p4s" path="res://styles/joystick.tres" id="2_jku7w"]
[ext_resource type="Texture2D" uid="uid://dtvpgmekyrkp" path="res://Sprites/joyknobpng.png" id="3_j7imu"]

[sub_resource type="CircleShape2D" id="CircleShape2D_17kxu"]
radius = 177.045

[sub_resource type="GDScript" id="GDScript_uqaij"]
script/source = "extends Sprite2D
@onready var joystick = $\"..\"


var pressing = false

@export var deadzone = 5
@onready var radius = $\"../CollisionShape2D\".shape.radius
@onready var maxLength = radius

func _ready():
	pass # Replace with function body.



# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta):
	if pressing:
		var target_position = get_global_mouse_position()
		var joystick_position = joystick.global_position
		var distance = joystick_position.distance_to(target_position)
		
		if distance <= maxLength:
			global_position = target_position
		else:
			var angle = atan2(target_position.y - joystick_position.y, target_position.x - joystick_position.x)
			global_position.x = joystick_position.x + cos(angle) * maxLength
			global_position.y = joystick_position.y + sin(angle) * maxLength
	else:
		global_position = lerp(global_position, joystick.global_position, delta * 20)

	position = position.limit_length(radius)
	calculateVector()

func calculateVector():
	joystick.posVector = Vector2(0,0)
	if(abs(global_position.x - joystick.global_position.x) >= deadzone):
		joystick.posVector.x = (global_position.x - joystick.global_position.x) / maxLength
	if(abs(global_position.y - joystick.global_position.y) >= deadzone):
		joystick.posVector.y = (global_position. y - joystick.global_position.y) / maxLength


func _on_button_button_down():
	pressing = true

func _on_button_button_up():
	pressing = false
"

[node name="joystick" type="Node2D"]
z_index = 20
scale = Vector2(1.3, 1.3)
script = ExtResource("1_35q8m")

[node name="Button" type="Button" parent="."]
offset_left = -191.0
offset_top = -184.0
offset_right = 191.0
offset_bottom = 186.0
theme_override_styles/normal = ExtResource("2_jku7w")
theme_override_styles/hover = ExtResource("2_jku7w")
theme_override_styles/pressed = ExtResource("2_jku7w")
theme_override_styles/focus = ExtResource("2_jku7w")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
shape = SubResource("CircleShape2D_17kxu")

[node name="knob" type="Sprite2D" parent="."]
scale = Vector2(0.07, 0.07)
texture = ExtResource("3_j7imu")
script = SubResource("GDScript_uqaij")

[connection signal="button_down" from="Button" to="knob" method="_on_button_button_down"]
[connection signal="button_up" from="Button" to="knob" method="_on_button_button_up"]
